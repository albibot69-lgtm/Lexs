local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local player = Players.LocalPlayer
local isFrozen = false
local lastPos = nil

local function notify(msg, color)
	pcall(function()
		StarterGui:SetCore("ChatMakeSystemMessage", {
			Text = "[FREEZE] " .. msg,
			Color = color or Color3.fromRGB(150,255,150),
			Font = Enum.Font.SourceSansBold,
			FontSize = Enum.FontSize.Size24
		})
	end)
end

local function freezeCharacter(char)
	if not char then return end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	local root = char:FindFirstChild("HumanoidRootPart")
	if not humanoid or not root then return end

	-- simpan posisi
	lastPos = root.CFrame

	humanoid.WalkSpeed = 0
	humanoid.JumpPower = 0
	humanoid.AutoRotate = false
	humanoid.PlatformStand = true

	for _, track in ipairs(humanoid:GetPlayingAnimationTracks()) do
		pcall(function() track:Stop(0) end)
	end
	local animator = humanoid:FindFirstChildOfClass("Animator")
	if animator then
		pcall(function() animator:Destroy() end)
	end

	root.Anchored = true
end

local function unfreezeCharacter(char)
	if not char then return end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	local root = char:FindFirstChild("HumanoidRootPart")
	if humanoid then
		humanoid.WalkSpeed = 16
		humanoid.JumpPower = 50
		humanoid.AutoRotate = true
		humanoid.PlatformStand = false
		if not humanoid:FindFirstChildOfClass("Animator") then
			local newAnimator = Instance.new("Animator")
			newAnimator.Parent = humanoid
		end
	end

	if root then
		root.Anchored = false
		if lastPos then
			root.CFrame = lastPos
		end
	end
end

local function toggleFreeze(state)
	isFrozen = state
	local char = player.Character or player.CharacterAdded:Wait()

	if state then
		freezeCharacter(char)
		notify("Karakter freeze", Color3.fromRGB(100,200,255))
	else
		unfreezeCharacter(char)
		notify("Karakter dilepaskan", Color3.fromRGB(255,150,150))
	end
end

-- Toggle UI
local Toggle = Tab2:Toggle({
	Title = "Freeze Character",
	Desc = "freeze your character",
	Icon = false,
	Type = false,
	Value = false,
	Callback = function(state)
		print("[FREEZE] Activated: " .. tostring(state))
		toggleFreeze(state)
	end
})

player.CharacterAdded:Connect(function(char)
	if isFrozen then
		task.wait(0.5)
		freezeCharacter(char)
	end
end)
